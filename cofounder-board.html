<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cofounder Decision Board</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes pulse-recording {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .recording-pulse {
            animation: pulse-recording 1.5s ease-in-out infinite;
        }
        .audio-waveform {
            background: linear-gradient(90deg, #3b82f6 0%, #8b5cf6 100%);
        }
    </style>
</head>
<body class="bg-gray-50">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Utility functions
        const generateId = () => Math.random().toString(36).substr(2, 9);

        const formatDate = (dateString) => {
            const date = new Date(dateString);
            return date.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        };

        const formatDuration = (seconds) => {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${mins}:${secs.toString().padStart(2, '0')}`;
        };

        // Category badge component
        const CategoryBadge = ({ category }) => {
            const colors = {
                opinion: 'bg-purple-100 text-purple-800 border-purple-200',
                fact: 'bg-blue-100 text-blue-800 border-blue-200',
                preference: 'bg-green-100 text-green-800 border-green-200'
            };
            return (
                <span className={`px-2 py-1 text-xs font-medium rounded-full border ${colors[category]}`}>
                    {category.charAt(0).toUpperCase() + category.slice(1)}
                </span>
            );
        };

        // User badge component
        const UserBadge = ({ user }) => {
            const colors = {
                Graham: 'bg-indigo-500',
                Nick: 'bg-amber-500'
            };
            return (
                <span className={`px-2 py-1 text-xs font-medium text-white rounded-full ${colors[user]}`}>
                    {user}
                </span>
            );
        };

        // Status badge component
        const StatusBadge = ({ status }) => {
            const colors = {
                open: 'bg-yellow-100 text-yellow-800',
                pending: 'bg-orange-100 text-orange-800',
                decided: 'bg-green-100 text-green-800'
            };
            return (
                <span className={`px-2 py-1 text-xs font-medium rounded ${colors[status]}`}>
                    {status.charAt(0).toUpperCase() + status.slice(1)}
                </span>
            );
        };

        // Voice recorder component
        const VoiceRecorder = ({ onRecordingComplete }) => {
            const [isRecording, setIsRecording] = useState(false);
            const [duration, setDuration] = useState(0);
            const mediaRecorderRef = useRef(null);
            const chunksRef = useRef([]);
            const timerRef = useRef(null);

            const startRecording = async () => {
                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorderRef.current = new MediaRecorder(stream);
                    chunksRef.current = [];

                    mediaRecorderRef.current.ondataavailable = (e) => {
                        chunksRef.current.push(e.data);
                    };

                    mediaRecorderRef.current.onstop = () => {
                        const blob = new Blob(chunksRef.current, { type: 'audio/webm' });
                        const reader = new FileReader();
                        reader.onloadend = () => {
                            onRecordingComplete({
                                data: reader.result,
                                duration: duration
                            });
                        };
                        reader.readAsDataURL(blob);
                        stream.getTracks().forEach(track => track.stop());
                    };

                    mediaRecorderRef.current.start();
                    setIsRecording(true);
                    setDuration(0);
                    timerRef.current = setInterval(() => {
                        setDuration(d => d + 1);
                    }, 1000);
                } catch (err) {
                    alert('Could not access microphone. Please ensure microphone permissions are granted.');
                }
            };

            const stopRecording = () => {
                if (mediaRecorderRef.current && isRecording) {
                    mediaRecorderRef.current.stop();
                    setIsRecording(false);
                    clearInterval(timerRef.current);
                }
            };

            return (
                <div className="flex items-center gap-3">
                    {!isRecording ? (
                        <button
                            onClick={startRecording}
                            className="flex items-center gap-2 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors"
                        >
                            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <circle cx="10" cy="10" r="6" />
                            </svg>
                            Record Voice Note
                        </button>
                    ) : (
                        <div className="flex items-center gap-3">
                            <div className="flex items-center gap-2 px-4 py-2 bg-red-100 text-red-700 rounded-lg">
                                <span className="w-3 h-3 bg-red-500 rounded-full recording-pulse"></span>
                                Recording... {formatDuration(duration)}
                            </div>
                            <button
                                onClick={stopRecording}
                                className="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors"
                            >
                                Stop
                            </button>
                        </div>
                    )}
                </div>
            );
        };

        // Audio player component
        const AudioPlayer = ({ audioData, duration }) => {
            const audioRef = useRef(null);
            const [isPlaying, setIsPlaying] = useState(false);
            const [currentTime, setCurrentTime] = useState(0);

            useEffect(() => {
                const audio = audioRef.current;
                if (audio) {
                    audio.ontimeupdate = () => setCurrentTime(audio.currentTime);
                    audio.onended = () => setIsPlaying(false);
                }
            }, []);

            const togglePlay = () => {
                if (audioRef.current) {
                    if (isPlaying) {
                        audioRef.current.pause();
                    } else {
                        audioRef.current.play();
                    }
                    setIsPlaying(!isPlaying);
                }
            };

            return (
                <div className="flex items-center gap-3 p-3 bg-gray-100 rounded-lg">
                    <audio ref={audioRef} src={audioData} />
                    <button
                        onClick={togglePlay}
                        className="w-10 h-10 flex items-center justify-center bg-indigo-500 text-white rounded-full hover:bg-indigo-600 transition-colors"
                    >
                        {isPlaying ? (
                            <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                <rect x="5" y="4" width="3" height="12" />
                                <rect x="12" y="4" width="3" height="12" />
                            </svg>
                        ) : (
                            <svg className="w-5 h-5 ml-1" fill="currentColor" viewBox="0 0 20 20">
                                <polygon points="5,3 19,10 5,17" />
                            </svg>
                        )}
                    </button>
                    <div className="flex-1">
                        <div className="h-2 bg-gray-300 rounded-full overflow-hidden">
                            <div
                                className="h-full audio-waveform transition-all duration-100"
                                style={{ width: `${(currentTime / (duration || 1)) * 100}%` }}
                            />
                        </div>
                    </div>
                    <span className="text-sm text-gray-600 font-mono">
                        {formatDuration(currentTime)} / {formatDuration(duration)}
                    </span>
                </div>
            );
        };

        // Contribution component
        const Contribution = ({ contribution, onReply, currentUser, level = 0 }) => {
            const [showReplyForm, setShowReplyForm] = useState(false);

            return (
                <div className={`${level > 0 ? 'ml-8 border-l-2 border-gray-200 pl-4' : ''}`}>
                    <div className="bg-white rounded-lg border border-gray-200 p-4 mb-3 shadow-sm">
                        <div className="flex items-center justify-between mb-3">
                            <div className="flex items-center gap-2">
                                <UserBadge user={contribution.user} />
                                <CategoryBadge category={contribution.category} />
                                <span className="text-sm text-gray-500">
                                    {formatDate(contribution.createdAt)}
                                </span>
                            </div>
                            {contribution.isApproval && (
                                <span className="px-3 py-1 bg-green-500 text-white text-sm font-medium rounded-full">
                                    ‚úì Approved
                                </span>
                            )}
                        </div>

                        {contribution.text && (
                            <p className="text-gray-700 mb-3">{contribution.text}</p>
                        )}

                        {contribution.voiceNote && (
                            <div className="mb-3">
                                <AudioPlayer
                                    audioData={contribution.voiceNote.data}
                                    duration={contribution.voiceNote.duration}
                                />
                            </div>
                        )}

                        {contribution.links && contribution.links.length > 0 && (
                            <div className="mb-3">
                                <h4 className="text-sm font-medium text-gray-600 mb-2">Attached Links:</h4>
                                <div className="space-y-1">
                                    {contribution.links.map((link, idx) => (
                                        <a
                                            key={idx}
                                            href={link.url}
                                            target="_blank"
                                            rel="noopener noreferrer"
                                            className="flex items-center gap-2 text-blue-600 hover:text-blue-800 text-sm"
                                        >
                                            {link.url.includes('docs.google.com') && (
                                                <span className="text-blue-500">üìÑ</span>
                                            )}
                                            {link.url.includes('drive.google.com') && (
                                                <span className="text-green-500">üìÅ</span>
                                            )}
                                            {link.url.includes('sheets.google.com') && (
                                                <span className="text-green-600">üìä</span>
                                            )}
                                            {!link.url.includes('google.com') && (
                                                <span>üîó</span>
                                            )}
                                            {link.title || link.url}
                                        </a>
                                    ))}
                                </div>
                            </div>
                        )}

                        <button
                            onClick={() => setShowReplyForm(!showReplyForm)}
                            className="text-sm text-indigo-600 hover:text-indigo-800 font-medium"
                        >
                            {showReplyForm ? 'Cancel Reply' : 'Reply'}
                        </button>

                        {showReplyForm && (
                            <div className="mt-3 pt-3 border-t border-gray-200">
                                <ContributionForm
                                    onSubmit={(data) => {
                                        onReply(contribution.id, data);
                                        setShowReplyForm(false);
                                    }}
                                    currentUser={currentUser}
                                    isReply={true}
                                />
                            </div>
                        )}
                    </div>

                    {contribution.replies && contribution.replies.map(reply => (
                        <Contribution
                            key={reply.id}
                            contribution={reply}
                            onReply={onReply}
                            currentUser={currentUser}
                            level={level + 1}
                        />
                    ))}
                </div>
            );
        };

        // Contribution form component
        const ContributionForm = ({ onSubmit, currentUser, isReply = false }) => {
            const [text, setText] = useState('');
            const [category, setCategory] = useState('opinion');
            const [voiceNote, setVoiceNote] = useState(null);
            const [links, setLinks] = useState([]);
            const [linkInput, setLinkInput] = useState('');
            const [isApproval, setIsApproval] = useState(false);

            const addLink = () => {
                if (linkInput.trim()) {
                    setLinks([...links, { url: linkInput.trim(), title: '' }]);
                    setLinkInput('');
                }
            };

            const removeLink = (idx) => {
                setLinks(links.filter((_, i) => i !== idx));
            };

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!text.trim() && !voiceNote && links.length === 0) {
                    alert('Please add some content (text, voice note, or links)');
                    return;
                }
                onSubmit({
                    id: generateId(),
                    user: currentUser,
                    category,
                    text: text.trim(),
                    voiceNote,
                    links,
                    isApproval,
                    createdAt: new Date().toISOString(),
                    replies: []
                });
                setText('');
                setCategory('opinion');
                setVoiceNote(null);
                setLinks([]);
                setIsApproval(false);
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4">
                    <div className="flex gap-4 flex-wrap">
                        <div>
                            <label className="block text-sm font-medium text-gray-700 mb-1">Category</label>
                            <select
                                value={category}
                                onChange={(e) => setCategory(e.target.value)}
                                className="px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            >
                                <option value="opinion">Opinion</option>
                                <option value="fact">Fact</option>
                                <option value="preference">Preference</option>
                            </select>
                        </div>
                        {isReply && (
                            <div className="flex items-end">
                                <label className="flex items-center gap-2 px-4 py-2 bg-green-50 border border-green-200 rounded-lg cursor-pointer hover:bg-green-100">
                                    <input
                                        type="checkbox"
                                        checked={isApproval}
                                        onChange={(e) => setIsApproval(e.target.checked)}
                                        className="w-4 h-4 text-green-600"
                                    />
                                    <span className="text-green-700 font-medium">Mark as Approval</span>
                                </label>
                            </div>
                        )}
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Your Input</label>
                        <textarea
                            value={text}
                            onChange={(e) => setText(e.target.value)}
                            placeholder="Share your thoughts, facts, or preferences..."
                            className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"
                            rows={3}
                        />
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Voice Note</label>
                        {voiceNote ? (
                            <div className="space-y-2">
                                <AudioPlayer audioData={voiceNote.data} duration={voiceNote.duration} />
                                <button
                                    type="button"
                                    onClick={() => setVoiceNote(null)}
                                    className="text-sm text-red-600 hover:text-red-800"
                                >
                                    Remove recording
                                </button>
                            </div>
                        ) : (
                            <VoiceRecorder onRecordingComplete={setVoiceNote} />
                        )}
                    </div>

                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-2">Document Links</label>
                        <div className="flex gap-2 mb-2">
                            <input
                                type="url"
                                value={linkInput}
                                onChange={(e) => setLinkInput(e.target.value)}
                                placeholder="Paste Google Drive, Docs, or any URL..."
                                className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            />
                            <button
                                type="button"
                                onClick={addLink}
                                className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                            >
                                Add Link
                            </button>
                        </div>
                        {links.length > 0 && (
                            <div className="space-y-1">
                                {links.map((link, idx) => (
                                    <div key={idx} className="flex items-center gap-2 text-sm">
                                        <span className="text-blue-600 truncate flex-1">{link.url}</span>
                                        <button
                                            type="button"
                                            onClick={() => removeLink(idx)}
                                            className="text-red-500 hover:text-red-700"
                                        >
                                            ‚úï
                                        </button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>

                    <button
                        type="submit"
                        className="w-full py-3 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors"
                    >
                        {isReply ? 'Post Reply' : 'Add Contribution'}
                    </button>
                </form>
            );
        };

        // Topic form component
        const TopicForm = ({ onSubmit, onCancel }) => {
            const [title, setTitle] = useState('');
            const [description, setDescription] = useState('');
            const [dueDate, setDueDate] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (!title.trim()) return;
                onSubmit({
                    id: generateId(),
                    title: title.trim(),
                    description: description.trim(),
                    dueDate: dueDate || null,
                    status: 'open',
                    createdAt: new Date().toISOString(),
                    contributions: []
                });
            };

            return (
                <form onSubmit={handleSubmit} className="space-y-4 p-4 bg-white rounded-lg border border-gray-200">
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Topic Title *</label>
                        <input
                            type="text"
                            value={title}
                            onChange={(e) => setTitle(e.target.value)}
                            placeholder="e.g., Q1 Marketing Budget Allocation"
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                            required
                        />
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Description</label>
                        <textarea
                            value={description}
                            onChange={(e) => setDescription(e.target.value)}
                            placeholder="Provide context about this decision..."
                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent resize-none"
                            rows={2}
                        />
                    </div>
                    <div>
                        <label className="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
                        <input
                            type="date"
                            value={dueDate}
                            onChange={(e) => setDueDate(e.target.value)}
                            className="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                        />
                    </div>
                    <div className="flex gap-2">
                        <button
                            type="submit"
                            className="flex-1 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700 transition-colors"
                        >
                            Create Topic
                        </button>
                        <button
                            type="button"
                            onClick={onCancel}
                            className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors"
                        >
                            Cancel
                        </button>
                    </div>
                </form>
            );
        };

        // AI Summary component
        const AISummary = ({ topic, apiKey }) => {
            const [summary, setSummary] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState(null);

            const generateSummary = async () => {
                if (!apiKey) {
                    setError('Please add your Claude API key in Settings');
                    return;
                }

                setLoading(true);
                setError(null);

                // Gather all contribution text
                const gatherText = (contributions, prefix = '') => {
                    let text = '';
                    contributions.forEach(c => {
                        text += `${prefix}[${c.user}] (${c.category}): ${c.text || '(voice note)'}\n`;
                        if (c.links?.length) {
                            text += `${prefix}  Links: ${c.links.map(l => l.url).join(', ')}\n`;
                        }
                        if (c.isApproval) {
                            text += `${prefix}  ** APPROVED **\n`;
                        }
                        if (c.replies?.length) {
                            text += gatherText(c.replies, prefix + '  ‚Üí ');
                        }
                    });
                    return text;
                };

                const contributionText = gatherText(topic.contributions);

                const prompt = `You are helping two cofounders (Graham and Nick) make decisions asynchronously.

Topic: ${topic.title}
Description: ${topic.description || 'No description'}
Status: ${topic.status}

Contributions:
${contributionText || 'No contributions yet'}

Please provide:
1. A brief summary of the discussion so far
2. Each person's stated preferences or positions
3. Key facts mentioned
4. Any agreements or approvals given
5. What still needs to be decided or discussed

Keep it concise and actionable.`;

                try {
                    const response = await fetch('https://api.anthropic.com/v1/messages', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': apiKey,
                            'anthropic-version': '2023-06-01',
                            'anthropic-dangerous-direct-browser-access': 'true'
                        },
                        body: JSON.stringify({
                            model: 'claude-sonnet-4-20250514',
                            max_tokens: 1024,
                            messages: [{ role: 'user', content: prompt }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error('API request failed');
                    }

                    const data = await response.json();
                    setSummary(data.content[0].text);
                } catch (err) {
                    setError('Failed to generate summary. Please check your API key.');
                } finally {
                    setLoading(false);
                }
            };

            return (
                <div className="bg-gradient-to-r from-purple-50 to-indigo-50 rounded-lg border border-purple-200 p-4">
                    <div className="flex items-center justify-between mb-3">
                        <h3 className="font-semibold text-purple-800 flex items-center gap-2">
                            <span>‚ú®</span> AI Summary
                        </h3>
                        <button
                            onClick={generateSummary}
                            disabled={loading}
                            className="px-4 py-1.5 bg-purple-600 text-white text-sm font-medium rounded-lg hover:bg-purple-700 transition-colors disabled:opacity-50"
                        >
                            {loading ? 'Generating...' : summary ? 'Refresh' : 'Generate Summary'}
                        </button>
                    </div>

                    {error && (
                        <p className="text-red-600 text-sm">{error}</p>
                    )}

                    {summary && (
                        <div className="prose prose-sm max-w-none text-gray-700 whitespace-pre-wrap">
                            {summary}
                        </div>
                    )}

                    {!summary && !error && !loading && (
                        <p className="text-purple-600 text-sm">
                            Click "Generate Summary" to get an AI-powered overview of this topic's discussion.
                        </p>
                    )}
                </div>
            );
        };

        // Settings modal
        const SettingsModal = ({ isOpen, onClose, apiKey, setApiKey }) => {
            const [inputKey, setInputKey] = useState(apiKey);

            if (!isOpen) return null;

            const handleSave = () => {
                setApiKey(inputKey);
                localStorage.setItem('claudeApiKey', inputKey);
                onClose();
            };

            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-white rounded-xl p-6 w-full max-w-md mx-4">
                        <h2 className="text-xl font-bold mb-4">Settings</h2>
                        <div className="space-y-4">
                            <div>
                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                    Claude API Key
                                </label>
                                <input
                                    type="password"
                                    value={inputKey}
                                    onChange={(e) => setInputKey(e.target.value)}
                                    placeholder="sk-ant-..."
                                    className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent"
                                />
                                <p className="text-xs text-gray-500 mt-1">
                                    Required for AI summaries. Get your key at console.anthropic.com
                                </p>
                            </div>
                        </div>
                        <div className="flex gap-2 mt-6">
                            <button
                                onClick={handleSave}
                                className="flex-1 py-2 bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700"
                            >
                                Save
                            </button>
                            <button
                                onClick={onClose}
                                className="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300"
                            >
                                Cancel
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Main App
        const App = () => {
            const [topics, setTopics] = useState(() => {
                const saved = localStorage.getItem('cofounderBoard');
                return saved ? JSON.parse(saved) : [];
            });
            const [selectedTopicId, setSelectedTopicId] = useState(null);
            const [currentUser, setCurrentUser] = useState('Graham');
            const [showTopicForm, setShowTopicForm] = useState(false);
            const [sortBy, setSortBy] = useState('date');
            const [showSettings, setShowSettings] = useState(false);
            const [apiKey, setApiKey] = useState(() => {
                return localStorage.getItem('claudeApiKey') || '';
            });

            // Save to localStorage
            useEffect(() => {
                localStorage.setItem('cofounderBoard', JSON.stringify(topics));
            }, [topics]);

            const selectedTopic = topics.find(t => t.id === selectedTopicId);

            const sortedTopics = [...topics].sort((a, b) => {
                if (sortBy === 'date') {
                    return new Date(b.createdAt) - new Date(a.createdAt);
                } else {
                    return a.title.localeCompare(b.title);
                }
            });

            const addTopic = (topic) => {
                setTopics([...topics, topic]);
                setSelectedTopicId(topic.id);
                setShowTopicForm(false);
            };

            const updateTopicStatus = (status) => {
                setTopics(topics.map(t =>
                    t.id === selectedTopicId ? { ...t, status } : t
                ));
            };

            const addContribution = (contribution) => {
                setTopics(topics.map(t =>
                    t.id === selectedTopicId
                        ? { ...t, contributions: [...t.contributions, contribution] }
                        : t
                ));
            };

            const addReply = (parentId, reply) => {
                const addReplyToContribution = (contributions) => {
                    return contributions.map(c => {
                        if (c.id === parentId) {
                            return { ...c, replies: [...(c.replies || []), reply] };
                        }
                        if (c.replies) {
                            return { ...c, replies: addReplyToContribution(c.replies) };
                        }
                        return c;
                    });
                };

                setTopics(topics.map(t =>
                    t.id === selectedTopicId
                        ? { ...t, contributions: addReplyToContribution(t.contributions) }
                        : t
                ));
            };

            const deleteTopic = (topicId) => {
                if (confirm('Are you sure you want to delete this topic?')) {
                    setTopics(topics.filter(t => t.id !== topicId));
                    if (selectedTopicId === topicId) {
                        setSelectedTopicId(null);
                    }
                }
            };

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* Header */}
                    <header className="bg-white border-b border-gray-200 sticky top-0 z-40">
                        <div className="max-w-7xl mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
                                        <span className="text-white text-xl">üìã</span>
                                    </div>
                                    <div>
                                        <h1 className="text-xl font-bold text-gray-900">Cofounder Decision Board</h1>
                                        <p className="text-sm text-gray-500">Async decisions, made together</p>
                                    </div>
                                </div>
                                <div className="flex items-center gap-4">
                                    <div className="flex items-center gap-2 bg-gray-100 p-1 rounded-lg">
                                        <button
                                            onClick={() => setCurrentUser('Graham')}
                                            className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${
                                                currentUser === 'Graham'
                                                    ? 'bg-indigo-500 text-white'
                                                    : 'text-gray-600 hover:text-gray-900'
                                            }`}
                                        >
                                            Graham
                                        </button>
                                        <button
                                            onClick={() => setCurrentUser('Nick')}
                                            className={`px-4 py-2 rounded-md text-sm font-medium transition-colors ${
                                                currentUser === 'Nick'
                                                    ? 'bg-amber-500 text-white'
                                                    : 'text-gray-600 hover:text-gray-900'
                                            }`}
                                        >
                                            Nick
                                        </button>
                                    </div>
                                    <button
                                        onClick={() => setShowSettings(true)}
                                        className="p-2 text-gray-500 hover:text-gray-700 hover:bg-gray-100 rounded-lg"
                                    >
                                        <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" />
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main content */}
                    <div className="max-w-7xl mx-auto px-4 py-6">
                        <div className="flex gap-6">
                            {/* Left panel - Topic list */}
                            <div className="w-80 flex-shrink-0">
                                <div className="bg-white rounded-xl border border-gray-200 overflow-hidden">
                                    <div className="p-4 border-b border-gray-200">
                                        <div className="flex items-center justify-between mb-3">
                                            <h2 className="font-semibold text-gray-800">Topics</h2>
                                            <button
                                                onClick={() => setShowTopicForm(true)}
                                                className="px-3 py-1.5 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition-colors"
                                            >
                                                + New Topic
                                            </button>
                                        </div>
                                        <div className="flex gap-2">
                                            <button
                                                onClick={() => setSortBy('date')}
                                                className={`px-3 py-1 text-sm rounded-md ${
                                                    sortBy === 'date'
                                                        ? 'bg-gray-200 text-gray-800'
                                                        : 'text-gray-500 hover:bg-gray-100'
                                                }`}
                                            >
                                                By Date
                                            </button>
                                            <button
                                                onClick={() => setSortBy('name')}
                                                className={`px-3 py-1 text-sm rounded-md ${
                                                    sortBy === 'name'
                                                        ? 'bg-gray-200 text-gray-800'
                                                        : 'text-gray-500 hover:bg-gray-100'
                                                }`}
                                            >
                                                By Name
                                            </button>
                                        </div>
                                    </div>

                                    {showTopicForm && (
                                        <div className="p-4 border-b border-gray-200 bg-gray-50">
                                            <TopicForm
                                                onSubmit={addTopic}
                                                onCancel={() => setShowTopicForm(false)}
                                            />
                                        </div>
                                    )}

                                    <div className="divide-y divide-gray-100 max-h-[calc(100vh-280px)] overflow-y-auto">
                                        {sortedTopics.length === 0 ? (
                                            <div className="p-6 text-center text-gray-500">
                                                <p>No topics yet.</p>
                                                <p className="text-sm">Create one to get started!</p>
                                            </div>
                                        ) : (
                                            sortedTopics.map(topic => (
                                                <div
                                                    key={topic.id}
                                                    onClick={() => setSelectedTopicId(topic.id)}
                                                    className={`p-4 cursor-pointer transition-colors ${
                                                        selectedTopicId === topic.id
                                                            ? 'bg-indigo-50 border-l-4 border-indigo-500'
                                                            : 'hover:bg-gray-50'
                                                    }`}
                                                >
                                                    <div className="flex items-start justify-between gap-2">
                                                        <div className="flex-1 min-w-0">
                                                            <h3 className="font-medium text-gray-900 truncate">
                                                                {topic.title}
                                                            </h3>
                                                            <p className="text-sm text-gray-500 mt-1">
                                                                {formatDate(topic.createdAt)}
                                                            </p>
                                                            {topic.dueDate && (
                                                                <p className="text-xs text-orange-600 mt-1">
                                                                    Due: {new Date(topic.dueDate).toLocaleDateString()}
                                                                </p>
                                                            )}
                                                        </div>
                                                        <StatusBadge status={topic.status} />
                                                    </div>
                                                    <div className="mt-2 text-xs text-gray-400">
                                                        {topic.contributions.length} contribution{topic.contributions.length !== 1 ? 's' : ''}
                                                    </div>
                                                </div>
                                            ))
                                        )}
                                    </div>
                                </div>
                            </div>

                            {/* Right panel - Topic detail */}
                            <div className="flex-1 min-w-0">
                                {selectedTopic ? (
                                    <div className="space-y-6">
                                        {/* Topic header */}
                                        <div className="bg-white rounded-xl border border-gray-200 p-6">
                                            <div className="flex items-start justify-between">
                                                <div>
                                                    <h2 className="text-2xl font-bold text-gray-900">
                                                        {selectedTopic.title}
                                                    </h2>
                                                    {selectedTopic.description && (
                                                        <p className="text-gray-600 mt-2">{selectedTopic.description}</p>
                                                    )}
                                                    <div className="flex items-center gap-4 mt-3 text-sm text-gray-500">
                                                        <span>Created: {formatDate(selectedTopic.createdAt)}</span>
                                                        {selectedTopic.dueDate && (
                                                            <span className="text-orange-600">
                                                                Due: {new Date(selectedTopic.dueDate).toLocaleDateString()}
                                                            </span>
                                                        )}
                                                    </div>
                                                </div>
                                                <div className="flex items-center gap-2">
                                                    <select
                                                        value={selectedTopic.status}
                                                        onChange={(e) => updateTopicStatus(e.target.value)}
                                                        className="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-indigo-500"
                                                    >
                                                        <option value="open">Open</option>
                                                        <option value="pending">Pending</option>
                                                        <option value="decided">Decided</option>
                                                    </select>
                                                    <button
                                                        onClick={() => deleteTopic(selectedTopic.id)}
                                                        className="p-2 text-red-500 hover:bg-red-50 rounded-lg"
                                                        title="Delete topic"
                                                    >
                                                        <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                                        </svg>
                                                    </button>
                                                </div>
                                            </div>
                                        </div>

                                        {/* AI Summary */}
                                        <AISummary topic={selectedTopic} apiKey={apiKey} />

                                        {/* Add contribution form */}
                                        <div className="bg-white rounded-xl border border-gray-200 p-6">
                                            <h3 className="font-semibold text-gray-800 mb-4">
                                                Add Your Input
                                                <span className="ml-2 text-sm font-normal text-gray-500">
                                                    (as {currentUser})
                                                </span>
                                            </h3>
                                            <ContributionForm
                                                onSubmit={addContribution}
                                                currentUser={currentUser}
                                            />
                                        </div>

                                        {/* Contributions */}
                                        <div className="space-y-4">
                                            <h3 className="font-semibold text-gray-800">
                                                Discussion ({selectedTopic.contributions.length})
                                            </h3>
                                            {selectedTopic.contributions.length === 0 ? (
                                                <div className="bg-gray-50 rounded-lg p-8 text-center text-gray-500">
                                                    <p>No contributions yet. Be the first to share your input!</p>
                                                </div>
                                            ) : (
                                                selectedTopic.contributions.map(contribution => (
                                                    <Contribution
                                                        key={contribution.id}
                                                        contribution={contribution}
                                                        onReply={addReply}
                                                        currentUser={currentUser}
                                                    />
                                                ))
                                            )}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-xl border border-gray-200 p-12 text-center">
                                        <div className="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                                            <span className="text-3xl">üìã</span>
                                        </div>
                                        <h2 className="text-xl font-semibold text-gray-800 mb-2">
                                            Select a Topic
                                        </h2>
                                        <p className="text-gray-500">
                                            Choose a topic from the list or create a new one to start collaborating.
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>

                    {/* Settings Modal */}
                    <SettingsModal
                        isOpen={showSettings}
                        onClose={() => setShowSettings(false)}
                        apiKey={apiKey}
                        setApiKey={setApiKey}
                    />
                </div>
            );
        };

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
